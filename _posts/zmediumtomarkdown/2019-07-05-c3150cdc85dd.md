---
title: 智慧家居初體驗 - Apple HomeKit & 小米米家
author: ZhgChgLi
date: 2019-07-05T17:13:47.487+0000
last_modified_at: 2021-02-24T01:33:46.431+0000
categories: ZRealm Life.
tags: [生活,開箱,3c,米家,homekit]
description: 米家智慧攝影機及米家智慧檯燈，米家、Homekit設定教學
image:
  path: assets/c3150cdc85dd/1*Aa9zfAh7xclVOZS0IkcaMQ.jpeg
render_with_liquid: false
---

### 智慧家居初體驗 \- Apple HomeKit & 小米米家

米家智慧攝影機及米家智慧檯燈、Homekit設定教學

**\[2020/04/20\]** [**進階篇已發**](../99db2a1fbfe5/) **：** 
**[有經驗的朋友請直接左轉前往>>](../99db2a1fbfe5/)** [**示範使用樹莓派當 HomeBridge 主機，將所有米家家電串上 HomeKit**](../99db2a1fbfe5/)
### 雜談：

最近剛搬完家；有別於原本住的地方，天花板是辦公室輕鋼架燈，亮到要拔掉幾根燈管眼睛才比較舒適；現在住的地方則是裝潢反射燈，使用電腦、看書亮度稍嫌不足，兩週下來眼睛覺得更容易乾澀不舒服；本想直接去IKEA採購，但考量到光色、護眼，最後比較一下CP值，於是還是選擇了小米檯燈\(加上之前已有買小米智慧攝影機，都是米家系列產品\)。
### 本篇：

其實我在選購時並沒有特別注意是否支援Apple HomeKit，身為一個iOS 開發者實在太失格了，因為我壓跟沒想到小米會支援．

所以本篇會分別介紹 **Apple HomeKit 使用** 、 **不支援Apple HomeKit的智慧家居怎麼使用第三方串接HomeKit？** 及 **使用米家本身搭建智慧家庭的方法（搭配IFTTT）**

大家可以根據自己的裝置需求跳著看。
### 採買：

我一共買了兩盞檯燈，一盞\(Pro\)放電腦桌工作用、另一盞放床頭當閱讀燈。
#### [米家檯燈 Pro](https://www.mi.com/tw/mi-adjustable-smart-desk-lamp/){:target="_blank"} ：


![NT$ 1,795 支援米家、Apple HomeKit](/assets/c3150cdc85dd/1*Aa9zfAh7xclVOZS0IkcaMQ.jpeg)

NT$ 1,795 支援米家、Apple HomeKit
#### [米家 LED 智慧檯燈](https://www.mi.com/tw/smartlamp/){:target="_blank"} ：


![NT$ 995 僅支援米家](/assets/c3150cdc85dd/1*PCaRI8AroRgFELEA1elaiA.jpeg)

NT$ 995 僅支援米家

詳細介紹可參考官網，兩盞都支援智慧控制、變色、調亮度、護眼，Pro版支援Apple HomeKit、三段角度調整；目前使用下來，以一盞燈的功能來說已經相當滿意，硬要挑一個缺點的話就是Pro版的角度調整只有底座能水平轉，燈不行，這樣就不能調整光線的角度了！
### 理想的智慧家居目標：
#### 目前有的裝置：
1. 米家智慧攝影機雲台版 1080P \(支援：米家\)
2. 米家檯燈 Pro \(支援：Apple HomeKit、米家\)
3. 米家 LED 智慧檯燈 \(支援：米家\)

#### 理想目標：

**回到家時：** 自動關閉攝影機\(為了隱私及防止誤觸看家警報，米家APP有BUG看家警報無法照設定時間開啟關閉\)、打開電腦桌的Pro燈\(不想摸黑\)
**離家時：** 自動打開攝影機\(預設啟用看家\)、關閉所有燈具
#### **本篇最終達成：**

離家、回家時發推播提醒，手機按一下觸發操作\(已現有裝置沒辦法達到理想的自動化目標\)
### 智慧家居設定之路：
#### **Apple HomeKit 使用**

**\*僅限米家檯燈 Pro！米家檯燈 Pro！米家檯燈 Pro！**

這是最簡單的一部分，因為都是原生功能。


![只需四步驟](/assets/c3150cdc85dd/1*pv62RZ_TjL8X6t-gXnwWtQ.jpeg)

只需四步驟
1. 找到家庭APP（如沒有請到App Store搜尋「家庭」安裝）
2. 打開家庭APP
3. 點擊右上角「\+」加入配近
4. 掃描Pro檯燈底部HomeKit QRCode加入配件即可！



![](/assets/c3150cdc85dd/1*0Rm1Ij86bD-fld-N-N1qJw.jpeg)


加入配件成功後，在配件上重壓\(3D TOUCH\)/長壓，即可調整亮度、顏色。
#### 那不 **支援Apple HomeKit的智慧家居怎麼使用第三方串接HomeKit？**

除了以上本身就支援的智慧裝置，那不支援Apple HomeKit的裝置是不是就完全無法透過家庭控制呢了？
本章節手把手教你將不支援的裝置\(攝影機、一般版檯燈\)也加入到「家庭」中！


> **Mac ONLY，WIN使用者請直接跳到使用米家的章節** 
 

> **我的裝置是MacOS 10\.14/iOS 12** 





**使用 [HomeBridge](https://github.com/nfarina/homebridge){:target="_blank"} ：**

HomeBridge透過使用Mac電腦作為橋接器，將不支援的裝置模擬成HomeKit設備，就可以加入到「家庭」的配件之中．


![運作比較](/assets/c3150cdc85dd/1*q2ctcxaaxLFExKXd-9NjPg.png)

運作比較

可以看到一個重點就是 **你要有一台Mac電腦保持開機狀態，才能保持橋接通道順暢** ；一但電腦關機、休眠，就無法控制那些HomeKit裝置。

當然網路上也有神人做法，自行買一塊樹莓派來玩，將樹莓派當成橋接器；但這涉及到太多技術，本篇不會介紹。

知道缺點後如果還想玩玩，可以繼續往下看或是跳到下一個直接使用米家的章節。

**第一步：**

安裝 [node\.js](https://nodejs.org/en/){:target="_blank"} ： [點我](https://nodejs.org/dist/v12.6.0/node-v12.6.0.pkg){:target="_blank"} [下載](https://nodejs.org/dist/v12.6.0/node-v12.6.0.pkg){:target="_blank"} ，安裝即可

**第二步：**

打開「終端機」輸入
```
sudo npm -v
```


![](/assets/c3150cdc85dd/1*RBRWT93L_abbhzTItL9Mhg.png)


查看node\.js npm套件管理工具是否安裝成功：顯示出版本號即表示成功！

**第三步：**

透過 npm 安裝 HomeBridge套件：
```
sudo npm -g install homebridge --unsafe-perm
```

等待安裝完成後…HomeBridge工具就算裝完了！

前面有提到 “HomeBridge就是透過使用Mac電腦作為橋接器，將不支援的裝置模擬成HomeKit設備”， **實際上HomeBridge只是一個平台，各裝置要加入要再另外找HomeBridge的外掛資源** 。

很好找，只要google或在github 搜尋「mija 產品英文名 homebridge」就會有許多資源；這邊介紹兩個我在用的裝置的資源：

**1\.米家攝影機雲臺版資源： [MijiaCamera](https://github.com/josepramon/homebridge-mijia-camera){:target="_blank"}**

攝影機是比較棘手的裝置，花了些時間研究並整理了一下；希望有幫助到有需要的人！

首先ㄧ樣用「終端機」下命令安裝這MijiaCamera這個npm套件
```
sudo npm install -g homebridge-mijia-camera
```

安裝完成後，我們需要取得攝影機的網路 **IP位址** 跟 **Token** 兩個資訊


![](/assets/c3150cdc85dd/1*n0TIhqyCoKZo7--ePZwuLA.jpeg)


打開米家APP → 攝影機 → 右上角「…」→設定→網路訊息，得到 **IP位址** ！

**Token** 資訊就比較麻煩了，需要你將手機連接到Mac上：


![打開 Itunes 介面](/assets/c3150cdc85dd/1*0ewSMEH7K2rzUlUtSB61vw.png)

打開 Itunes 介面

選備份 **不要勾替本機備份加密** ，點「立即備份」

備份完成後， [下載](http://www.imactools.com/iphonebackupviewer/download/mac){:target="_blank"} 安裝備份查看軟體： [iBackupViewer](http://www.imactools.com/iphonebackupviewer/download/mac){:target="_blank"}

打開「iBackupViewer」，初次啟動會要你去 Mac「系統偏好設定」\- 「安全性與隱私權」\-「隱私權」\-「\+」\- 加入「iBackupViewer」
**_\*如有隱私顧慮可關閉網路使用這套軟體、並在使用後移除_**


![](/assets/c3150cdc85dd/1*kEOxJCkOxDRuFfoxumssgA.png)


再次打開「iBackupViewer」成功讀取到備份檔後，點擊右上角切換到「Tree View」模式


![](/assets/c3150cdc85dd/1*R4l6tRzDaqtiN7xutPKtQg.png)


左側會顯示你所有安裝的APP，找到米家的APP「AppDomain\-com\.xiaomi\.mihome」\->「Documents」

在右側文件列表中找到並選擇 「 **數字\_mihome\.sqlite」** 這個檔案

點擊右上角「Export」匯出 \->「Selected」

將剛剛匯出的sqlite檔案丟到 [https://inloop\.github\.io/sqlite\-viewer/](https://inloop.github.io/sqlite-viewer/){:target="_blank"} 查看內容


![](/assets/c3150cdc85dd/1*oRK8tHqom2tnR3CE5xz_-w.png)


可以看到所有米家APP上的裝置資訊欄位，向右滾動到尾端，找到 **ZTOKEN** 欄位，雙擊編輯全選複製

最後再打開 [http://aes\.online\-domain\-tools\.com/](http://aes.online-domain-tools.com/){:target="_blank"} 網站將 **ZTOKEN** 轉成最終 **Token**


![](/assets/c3150cdc85dd/1*ZXTe6MEFXjYhqtf9uAJWwQ.png)


1\.將剛剛複製出來的 ZTOKEN貼在「Input Text」，選「Hex」
2\.Key輸入「00000000000000000000000000000000」32個0，ㄧ樣選「Hex」
3\.然後按下「Decrypt\!」轉換
4\.全選複製右下角藍匡＆去掉空格後就是我們要的結果 **Token**


> Token 這邊有嘗試用「miio」直接嗅探的方式，但好像是米家攝影機韌體有更新過，已無法用這個方法快速方便得到Token了！ 





**回到HomeBridge！編輯設定檔 config\.json**


![](/assets/c3150cdc85dd/1*Zh_BWLwMUg5pOxFEVipgiQ.png)


使用「Finder」\->「前往」\->「前往檔案夾」\-> 輸入「~/\.homebridge」前往

使用文字編輯器打開「config\.json」，若沒有此檔案請自行建立一個或 [點此下載](https://drive.google.com/file/d/1S67NZwXrVqOpps_Cl9l0494foDaHxuWF/view?usp=sharing){:target="_blank"} 直接放進去
