---
title: 自己的電話自己辨識(Swift)
author: ZhgChgLi
date: 2019-04-27T16:07:27.133+0000
last_modified_at: 2021-02-24T01:32:40.250+0000
categories: ZRealm Dev.
tags: [ios,whoscall,swift,ios-app-development,ios-apps]
description: iOS自幹 Whoscall 來電辨識、電話號碼標記 功能
image:
  path: assets/ac557047d206/1*MYWY8n6v6YoGs0u5um0RdQ.jpeg
render_with_liquid: false
---

### 自己的電話自己辨識\(Swift\)

iOS自幹 Whoscall 來電辨識、電話號碼標記 功能
#### 起源

一直以來都是Whoscall的忠實用戶，從原本用Android手機時就有使用，能夠非常即時的顯示陌生來電資訊，當下就能直接決定接通與否；後來轉跳蘋果陣營，第一隻蘋果手機是iPhone 6 \(iOS 9\)，那時在使用Whoscall上非常彆扭，無法即時辨識電話，要複製電話號碼去APP查詢，後期Whoscall提供將陌生電話資料庫安裝在本地手機的服務，雖然能解決即時辨識的問題，但很容易就弄亂你的手機通訊錄！

直到 iOS 10\+ 之後蘋果開放電話辨識功能\(Call Directory Extension\)權限給開發者，才使whoscall目前至少就體驗來說已和Android版無太大缺別，甚至超越Android版\(Android版廣告超多，但以開發者的立場是可以理解的\)
#### 用途？

[Call Directory Extension](https://developer.apple.com/documentation/callkit/cxcalldirectoryextensioncontext){:target="_blank"} 能做到什麼呢？
1. 電話 **撥打** 辨識標記
2. 電話 **來電** 辨識標記
3. **通話紀錄** 辨識標記
4. 電話 **拒接** 黑名單設置

#### 限制？
1. 使用者需手動進入「設定」「電話」「通話封鎖與識別」打開您的APP才能使用
2. 僅能以離線資料庫方式辨識電話\(無法即時取得來電資訊然後Call API查詢，僅能預先寫入號碼<\->名稱對應在手機資料庫中\)
_\*也因此Whoscall會定期推播請使用者開APP更新來電辨識資料庫_
3. 數量上限？目前沒查到資料，應該是依照使用者手機容量無特別上限；但是數量多得辨識清單、封鎖清單要分批處理寫入！
4. 軟體限制：iOS 版本需 ≥ 10



![「設定」\->「電話」\->「通話封鎖與識別」](/assets/ac557047d206/1*MYWY8n6v6YoGs0u5um0RdQ.jpeg)

「設定」\->「電話」\->「通話封鎖與識別」
#### 應用場景？
1. 通訊軟體、辦公室通訊軟體；在APP內你可能有對方的聯絡人，但實際並未將手機號碼加入手機通訊錄中，這個功能就能避免同事甚至老闆來電時，被當陌生電話，結果漏接．
2. 敝站\( [結婚吧](https://www.marry.com.tw){:target="_blank"} \)或敝私的\( [591房屋交易](https://www.591.com.tw/){:target="_blank"} \)，使用者與店家或房東聯繫時所撥打的電話都是我們的轉接號碼，經由轉接中心在轉撥到目標電話，大致流程如下：



![](/assets/ac557047d206/1*BXrzNfimPVPCQ0_XsY5HRg.png)


使用者所撥打的電話都是轉接中心代表號\( \#分機\)，不會知道真實的電話號碼；一方面是保護個資隱私、另一方面也能知道有多少人聯絡商家\(評估成效\)甚至能知道是在哪看到然後撥打的\(EX:網頁顯示\#1234,APP顯示\#5678\)、還有也能推免費服務，由我方吸收電話通信費用．

但此做法會帶來ㄧ項不可避免的問題，就是電話號碼凌亂；無法辨識出是打給誰或是店家回撥時，使用者不知道來電者是誰，透過使用電話辨識功能就能大大解決這個問題，提升使用者體驗！
#### 直接上一張成品圖：


![[結婚吧 APP](https://itunes.apple.com/tw/app/%E7%B5%90%E5%A9%9A%E5%90%A7-%E6%9C%80%E5%A4%A7%E5%A9%9A%E7%A6%AE%E7%B1%8C%E5%82%99app/id1356057329?mt=8){:target="_blank"}](/assets/ac557047d206/1*WEUjz38cymEtywWDvm86vg.jpeg)

[結婚吧 APP](https://itunes.apple.com/tw/app/%E7%B5%90%E5%A9%9A%E5%90%A7-%E6%9C%80%E5%A4%A7%E5%A9%9A%E7%A6%AE%E7%B1%8C%E5%82%99app/id1356057329?mt=8){:target="_blank"}

可以看到在輸入電話、電話來電時能直接顯示辨識結果、通話記錄列表也不在亂糟糟ㄧ樣能在下方顯示辨識結果．
### Call Directory Extension 電話辨識功能運作流程：


![](/assets/ac557047d206/1*f0vCDqocPfZkoPJW7w3vBg.png)

### 開工：

讓我們開始動手做吧！
#### 1\.為 iOS 專案加入 Call Directory Extension


![Xcode \-> File \-> New \-> Target](/assets/ac557047d206/1*k7RnXKeXW2uZPawkYQfIDg.png)

Xcode \-> File \-> New \-> Target


![選擇 Call Directory Extension](/assets/ac557047d206/1*w5sK8DfqYOTUTPDJVYFyLg.png)

選擇 Call Directory Extension


![輸入Extension名稱](/assets/ac557047d206/1*EqazaGGWvgLSQa0gQMYF7Q.png)

輸入Extension名稱


![可順帶加入 Scheme 方便 Debug](/assets/ac557047d206/1*WklbrBGAppM2leAsCuuKLg.png)

可順帶加入 Scheme 方便 Debug


![目錄底下就會出現Call Directory Extension的資料夾及程式](/assets/ac557047d206/1*8SfvjnXa2be6C8mdLk3Wwg.png)

目錄底下就會出現Call Directory Extension的資料夾及程式
#### 2\.開始編寫 Call Directory Extension 相關程式

首先回到主 iOS 專案上

**第一個問題是我們該如何判斷使用者的裝置支不支援Call Directory Extension或是設定中的「通話封鎖與識別」是否已經打開：**
