---
title: Visitor Pattern in iOS (Swift)
author: ZhgChgLi
date: 2021-06-15T15:58:36.329+0000
last_modified_at: 2022-04-07T15:06:40.478+0000
categories: ZRealm Dev.
tags: [ios-app-development,swift,design-patterns,visitor-pattern,double-dispatch]
description: Design Pattern Visitor 在 iOS 開發的實際應用場景分析
image:
  path: assets/ba5773a7bfea/1*Q1BLU8QHVBLEMx6KlMSHWQ.jpeg
render_with_liquid: false
---

### Visitor Pattern in Swift

Design Pattern Visitor 的實際應用場景分析


![Photo by [Daniel McCullough](https://unsplash.com/@d_mccullough?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText){:target="_blank"}](/assets/ba5773a7bfea/1*Q1BLU8QHVBLEMx6KlMSHWQ.jpeg)

Photo by [Daniel McCullough](https://unsplash.com/@d_mccullough?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText){:target="_blank"}
#### 前言

「Design Pattern」從知道有這個東西到現在也超過 10 年了依然沒辦法有自信的說能完全掌握，一直以來都是矇矇懂懂的，也好幾次從頭到尾把所有模式都看過一遍，但看了沒內化、沒在實務上應用很快就忘了。


> _我真的廢。_ 




#### 內功與招式

曾經看到的一個很好的比喻 ，招式部分如：PHP、Laravel、iOS、Swift、SwiftUI…之類的應用，其實在其中切換學習門檻都不算高；但內功部分如：演算法、資料結構、設計模式…等等都屬於內功；內功與招式之間有著相輔相成的效果；但是招式好學，內功難練；招式厲害的內功不一定厲害，內功厲害的也可以很快學會招式，所以與其說相輔相成不如說內功才是基礎，搭配招式才能所向披靡。
#### 找到適合自己的學習方式

基於之前的學習經驗，我認為適合我自己的學習 Design Pattern 方式是 — 先精再通；先著重於精通幾個模式，要能內化跟靈活運用，還要培養出嗅覺，能判斷什麼場景適合什麼場景不適合；再一步一步的累積新模式，直到全部掌握；我覺得最好的方式就是多找實務場境，從應用中學習。
#### 學習資源

推薦兩個免費的學習資源
- [https://refactoringguru\.cn/](https://refactoringguru.cn/){:target="_blank"} ：完整介紹所有模式結構、場景、相互關係
- [https://shirazian\.wordpress\.com/2016/04/11/design\-patterns\-in\-swift/](https://shirazian.wordpress.com/2016/04/11/design-patterns-in-swift/){:target="_blank"} ：作者以實際開發 iOS 的場景介紹更個模式的應用，本文也會以這個方向撰寫

### Visitor — Behavioral Patterns

第一章紀錄的是 Visitor Pattern，這也是在街聲工作一年挖到的金礦之一，在 StreetVoice App 中有諸多善用 Visitor 解決架構問題的地方；我也在這段經歷之中席的了 Visitor 的原理精髓；所以第一章就來寫它！
#### Visitor 是什麼

首先請先了解 Visitor 是什麼？想要解決什麼問題？組成結構是什麼？


![圖片取自 [refactoringguru](https://refactoringguru.cn/design-patterns/visitor){:target="_blank"}](/assets/ba5773a7bfea/1*rbswlsges8_oS3pNI1-WKA.png)

圖片取自 [refactoringguru](https://refactoringguru.cn/design-patterns/visitor){:target="_blank"}

詳細內容這邊不再重複贅述，請先直接參考 [refactoringguru 對於 Visitor 的講解](https://refactoringguru.cn/design-patterns/visitor){:target="_blank"} 。
### iOS 實務場景\(一\)

假設今天我們有以下幾個 Model：UserModel、SongModel、PlaylistModel 這三個 Model，現在我們要實作分享功能，可以分享到：Facebook、Line、Instagram，這三個平台；每個 Model 需要呈現的分享訊息皆為不同、每個平台需要的資料也各有不同：


![](/assets/ba5773a7bfea/1*ad2ijo5Bvm9_wnM1g2LNog.png)


組合場景如上圖，第一個表格顯示各 Model 的客製化內容、第二個表格顯示各分享平台需要的資料。


> **_尤其 Instagram 在分享 Playlist 時要多張圖片，跟其他分享要的 source 不一樣。_** 




#### 定義 Model

首先把各個 Model 有哪些 Property 定義完成：
