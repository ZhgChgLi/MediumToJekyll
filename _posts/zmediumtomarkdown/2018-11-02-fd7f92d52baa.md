---
title: 從 iOS 9 到 iOS 12 推播通知權限狀態處理(Swift)
author: ZhgChgLi
date: 2018-11-02T15:23:44.057+0000
last_modified_at: 2021-02-24T01:29:00.923+0000
categories: ZRealm Dev.
tags: [ios,push-notification,observables,ios-app-development,swift]
description: 適配 iOS 9 ~ iOS 12 處理通知權限狀態及要求權限的解決方案
image:
  path: assets/fd7f92d52baa/1*fm_hG0GuT-BhSNTEB3Ht1g.jpeg
render_with_liquid: false
---

### 從 iOS 9 到 iOS 12 推播通知權限狀態處理\(Swift\)

適配 iOS 9 ~ iOS 12 處理通知權限狀態及要求權限的解決方案
### 做什麼？

接續前一篇「 [什麼？iOS 12 不需使用者授權就能傳送推播通知\(Swift\)](https://medium.com/@zhgchgli/%E4%BB%80%E9%BA%BC-ios-12-%E4%B8%8D%E9%9C%80%E4%BD%BF%E7%94%A8%E8%80%85%E6%8E%88%E6%AC%8A%E5%B0%B1%E8%83%BD%E6%94%B6%E5%88%B0%E6%8E%A8%E6%92%AD%E9%80%9A%E7%9F%A5-swift-ade9e745a4bf?fbclid=IwAR1AKi3io4Jt-rFFgrLWEFsmA0lKYVFUD7Dw9n9LpMa2zAzJCHeGGGgn9Vs){:target="_blank"} 」提到的推播權限取得流程優化，經過上一篇Murmur部分寫的優化之後又遇到了新的需求：


![](/assets/fd7f92d52baa/1*fm_hG0GuT-BhSNTEB3Ht1g.jpeg)

1. 使用者若關閉通知功能，我們能在特定功能頁面提示他去設定開啟
2. 跳轉至設定頁後，若有打開/關閉通知的操作，回到APP要能跟著更改狀態
3. 沒詢問過推播權限時詢問權限，有詢問過但是不允許則跳提示，有詢問過又是允許則能繼續操作
4. iOS 9 ~ iOS 12 都要支援


1~3 都還好，使用 iOS 10 之後的Framework UserNotifications 差不多都能妥善的解決，麻煩的是第4項 要能支援 iOS 9，iOS 9要使用 registerUserNotificationSettings 舊的方式處理起來並不容易；就讓我們一步一步做起吧！
### 思路及架構：

首先宣告一個全域的 notificationStatus物件 儲存通知權限狀態 並在需要處理的頁面加上屬性監聽（這邊我使用 [Observable](https://github.com/slazyk/Observable-Swift){:target="_blank"} 做屬性變化的訂閱、可自行找適合的KVO或用Rx、ReactiveCocoa）

並在 appDelegate 中 didFinishLaunchingWithOptions \(APP初始打開時\)、applicationDidBecomeActive \(從背景狀態回復時\)、didRegisterUserNotificationSettings \(≤iOS 9 的推播詢問處理\) 
這些方法中處理檢查推播通知權限狀態並更改 notificationStatus 的值
需要做處理的頁面就會觸發並作相對應的處理（EX: 跳出通知被關閉提示）
#### 1\. 首先宣告全域 notificationStatus 物件
