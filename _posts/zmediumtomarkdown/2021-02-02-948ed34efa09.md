---
title: iOS 跨平台帳號密碼整合加強登入體驗
author: ZhgChgLi
date: 2021-02-02T14:13:50.686+0000
last_modified_at: 2021-02-24T01:44:22.830+0000
categories: ZRealm Dev.
tags: [ios,ios-app-development,password-security,web-credential,sign-in-with-apple]
description: 比 Sign in with Apple 更值得加入的功能
image:
  path: assets/948ed34efa09/1*QRYrbCDXcDmUU9fK66YgAA.jpeg
render_with_liquid: false
---

### iOS 跨平台帳號密碼整合，加強登入體驗

除 Sign in with Apple 也值得加入的功能


![Photo by [Dan Nelson](https://unsplash.com/@danny144?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText){:target="_blank"}](/assets/948ed34efa09/1*QRYrbCDXcDmUU9fK66YgAA.jpeg)

Photo by [Dan Nelson](https://unsplash.com/@danny144?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText){:target="_blank"}
### 功能

在同時有網站又有 APP 的服務中最常遇到的問題就是使用者在網站登入註冊過，且有記憶密碼；但被引導安裝 APP 後，打開登入要從頭輸入帳號密碼非常不方便；此功能就是能將已存在在手機的帳號密碼自動帶入到與網站關聯的 APP 之中，加速使用者登入流程。
### 效果圖


![](/assets/948ed34efa09/1*z-zjGdt17LYCr8Am6kekFA.gif)


不囉唆，先上完成效果圖；第一眼看到可能會以為是 iOS ≥ 11 Password AutoFill 功能；不過請您仔細看，鍵盤並沒有跳出來，而且我是點擊「選擇已存密碼」按鈕才跳出帳號密碼選擇視窗的。

既然提到了 Password AutoFill 那就先讓我賣個關子，先介紹 Password AutoFill 和如何設置吧！
### Password AutoFill


![](/assets/948ed34efa09/1*BZQcOoRV5IcRuI2HsSmKRQ.gif)


支援度：iOS ≥ 11

到如今已經 iOS 14 了，這個功能已經非常常見沒什麼特別的；在 APP 中的帳號密碼登入頁，叫出鍵盤輸入時可以快速選擇網站版服務的帳號密碼，選擇後就能自動帶入，快速登入！
#### 那麼 APP 與 Web 之間是如何相認的呢？

Associated Domains！我們在 APP 中指定 Associated Domains 並在網站上上傳 apple\-app\-site\-association 檔案，兩邊就能相認。

**1\.在專案設定中的「Signing & Capabilities」\-> 左上「\+ Capabilities」\->「Associated Domains」**


![](/assets/948ed34efa09/1*0oVHvGSzUA5cohhsSyuamA.png)


新增 `webcredentials:你的網站域名` \(ex: `webcredentials:google.com` \)。

**2\.進入 [蘋果開發者後台](https://developer.apple.com/account/){:target="_blank"}**

在「 **Membership** 」Tab 地方記錄下「 **Team ID** 」


![](/assets/948ed34efa09/1*LLlPP2VVCinVdrMsXWvj3g.png)


**3\.進入「Certificates, Identifiers & Profiles」\->「Identifiers」\-> 找到你的專案 \-> 打開「Associated Domains」功能**


![](/assets/948ed34efa09/1*ssGVeTV7AAfkbf1iYeQX7Q.png)


**APP 端設定完成！**

**4\.Web網站端設定**

建立一個名為「 **apple\-app\-site\-association** 」的檔案\(無副檔名\)，使用文字編輯器編輯，並輸入以下內容：
```
{
  "webcredentials": {
    "apps": [
      "TeamID.BundleId"
    ]
  }
}
```

將 `TeamID.BundleId` 換成你的專案設定 \(ex: TeamID = `ABCD` , BundleID = `li.zhgchg.demoapp` => `ABCD.li.zhgchg.demoapp` \)

將此檔案上傳到網站 `根目錄` 或 `/.well-known` 目錄下，假設你的 `webcredentials 網站域名` 是設 `google.com` 則此檔案就要是 `google.com/apple-app-site-association` 或 `google.com/.well-know/apple-app-site-association` 有辦法存取到的。

**補充：Subdomains**


![](/assets/948ed34efa09/1*ObLXi_XGDDR4A3Mo1WdIEA.png)


摘錄官方文件，如果是 subdomains 則都須列在 Associated Domains 之中。

**Web 端設定完成！**

**補充：applinks**

這邊有發現如果有設過 universal link `applinks` ，其實不用再多加 `webcredentials` 部分也能有效果；但我們還是照文件來吧，難保之後不會有其他問題。
#### 回到程式

Code 部分，我們只需要將 TextField 設為 ：
```
usernameTextField.textContentType = .username
passwordTextField.textContentType = .password
```

如果是新註冊，密碼確認欄位可使用：
```
repeatPasswordTextField.textContentType = .newPassword
```

這時候再重 Build & Run APP 後，在輸入帳號時鍵盤上方就會出現同個網站下已存密碼的選項了。
#### 完成！


![](/assets/948ed34efa09/1*VKsfZLnzoNno-IgPRp-odg.jpeg)

#### 沒出現？

可能是沒打開自動填寫密碼功能（模擬器預設是關閉），請到「設定」\->「密碼」\->「自動填寫密碼」\->打開「自動填寫密碼」。


![](/assets/948ed34efa09/1*a0vCvZA6PajjOwc8DFymIg.jpeg)


抑或是該網站沒有已存在的密碼，一樣可在「設定」\->「密碼」\-> 右上角「\+ 新增」\-> 新增。


![](/assets/948ed34efa09/1*kOsFAy-UifNMor84LGEovw.jpeg)

### 進入主題

前菜 Password AutoFill 介紹完之後，再來進入本篇主題；如何達到效果圖中的效果呢。
#### [Shared Web Credentials](https://developer.apple.com/documentation/security/shared_web_credentials){:target="_blank"}

始於 iOS 8\.0 只是之前很少看到 APP 使用，早在 Password AutoFill 出來之前其實就能使用此 API 整合網站帳號密碼讓使用者快速選擇。

Shared Web Credentials 除了能讀取帳號密碼，還能新增帳號密碼、對已存的帳號密碼進行修改、刪除。
#### 設定


> **_⚠️ 設定部分一樣要設好 Associated Domains，同前述 Password AutoFill 設定。_** 






> 所以可以說是 Password AutoFill 功能的加強版！！ 




因為一樣要先設好 Password AutoFill 需要的環境才能使用此「進階」功能。
#### 讀取

讀取使用 `SecRequestSharedWebCredential` 方法進行操作：
