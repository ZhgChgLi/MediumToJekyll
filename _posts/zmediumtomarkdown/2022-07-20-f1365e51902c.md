---
title: App Store Connect API 現已支援 讀取和管理 Customer Reviews
author: ZhgChgLi
date: 2022-07-20T14:50:44.659+0000
last_modified_at: 2022-08-10T12:22:02.132+0000
categories: ZRealm Dev.
tags: [ios-app-development,app-store-connect,api,app-review,integration]
description: App Store Connect API 2.0+ 全面更新，支援 In-app purchases、Subscriptions、Customer Reviews 管理
image:
  path: assets/f1365e51902c/1*hHJ66r9BgJQsGnRYqbB_8g.png
render_with_liquid: false
---

### App Store Connect API 現已支援 讀取和管理 Customer Reviews

App Store Connect API 2\.0\+ 全面更新，支援 In\-app purchases、Subscriptions、Customer Reviews 管理
### 2022/07/19 News


![[Upcoming transition from the XML feed to the App Store Connect API](https://developer.apple.com/news/?id=yqf4kgwb){:target="_blank"}](/assets/f1365e51902c/1*hHJ66r9BgJQsGnRYqbB_8g.png)

[Upcoming transition from the XML feed to the App Store Connect API](https://developer.apple.com/news/?id=yqf4kgwb){:target="_blank"}

今早收到 [Apple 開發者最新消息](https://developer.apple.com/news/rss/news.rss){:target="_blank"} ，App Store Connect API 新增支援 In\-app purchases、Subscriptions、Customer Reviews 管理三項功能；讓開發者可以更彈性的將 Apple 開發流程與 CI/CD 或是商業後台做更密切、有效率的整合！

In\-app purchases、Subscriptions 我沒碰，Customer Reviews 讓我興奮不已，之前發表過一篇「 [**AppStore APP’s Reviews Slack Bot 那些事**](../cb0c68c33994/) 」探討 App 評價與工作流程整合的方式。


![Slack 評價機器人 — [ZReviewsBot](https://github.com/ZhgChgLi/ZReviewsBot){:target="_blank"}](/assets/f1365e51902c/1*igukM7FTLxaX2hpVtFPMjQ.png)

Slack 評價機器人 — [ZReviewsBot](https://github.com/ZhgChgLi/ZReviewsBot){:target="_blank"}

在 App Store Connect API 還沒支援之前，只有兩種方法能獲取 iOS App 評價：

**一 是** 透過訂閱 [Public RSS](https://rss.itunes.apple.com/zh-tw){:target="_blank"} 取得，但是此 RSS 無法讓人彈性篩選、給的資訊也少、有數量上限、還有我們偶爾會遇到資料錯亂問題，很不穩定

**二 是** 透過 [**Fastlane**](https://fastlane.tools/){:target="_blank"} **— [SpaceShip](https://github.com/fastlane/fastlane/tree/master/spaceship){:target="_blank"}** 幫我們封裝複雜的網頁操作、Session 管理，去 App Store Connection 網站後台撈取評價資料 \(等於是起一個網頁模擬器爬蟲去後台爬資料\)。
- 好處是資料齊全、穩定，我們串接了一年沒有遇到任何資料問題。
- 壞處是 Session 每個月都會過期，要手動重新登入，而且 Apple ID 目前全面都要綁定 2FA 驗證，所以這段也要手動完成，這樣才能產出有效的 Session；另外 Session 如果產的跟用的 IP 不一樣會馬上過期 \(因此很難將機器人放上不固定 IP 的網路服務\)。



![[important\-note\-about\-session\-duration](https://docs.fastlane.tools/best-practices/continuous-integration/#important-note-about-session-duration){:target="_blank"} by Fastlane](/assets/f1365e51902c/0*iMQRza9LN3ljy2k1.png)

[important\-note\-about\-session\-duration](https://docs.fastlane.tools/best-practices/continuous-integration/#important-note-about-session-duration){:target="_blank"} by Fastlane
- 每個月不定時過期，要不定時去更新，時間久了真的很煩；而且這個 「 **Know How** 」其實不好交接給其他同事。



> 但因為沒有其他方法，所以也只能這樣，直到今天早上收到消息…\. 





> **⚠️ 注意：官方預計在 2022/11 取消原本的 XML \(RSS\) 存取方式。** 




### 2022/08/10 Update

我已基於新的 App Store Connect API 開發了新的 「 [ZReviewTender — 免費開源的 App Reviews 監控機器人](../e36e48bb9265/) 」
### App Store Connect API 2\.0\+ Customer Reviews 試玩
#### 建立 App Store Connect API Key

首先我們要登入 App Store Connect 後台，前往「Users and Access」\->「Keys」\->「 [**App Store Connect API**](https://appstoreconnect.apple.com/access/api){:target="_blank"} 」：


![](/assets/f1365e51902c/1*0NimMOcIqQ95nzjBBKYe8A.png)


點擊「\+」，輸入名稱和權限；權限細則可參考官網說明，為了減少測試問題，這邊先選擇「App Manager」把權限開到最大。


![](/assets/f1365e51902c/1*Bt8ddt7GrZs1ERaFamftVw.png)


點擊右方「Download API Key」下載保存你的「AuthKey\_XXX\.p8」Key。


> ⚠️ 注意：這個 Key 只能下載一次請 **妥善保存** ，若遺失只能 Revoke 現有的 & 重新建立。⚠️ 





> **⚠️ 切勿外洩 \.p8 Key File⚠️** 




#### App Store Connect API 存取方式
```
curl -v -H 'Authorization: Bearer [signed token]' "https://api.appstoreconnect.apple.com/v1/apps"
```
#### Signed Token \(JWT, JSON Web Token\) 產生方式

參考 [官方文件](https://developer.apple.com/documentation/appstoreconnectapi/generating_tokens_for_api_requests){:target="_blank"} 。


![](/assets/f1365e51902c/1*KDv2ra17oSp5UXKy-VZA1g.png)

- JWT Header：

```
{kid:"YOUR_KEY_ID", typ:"JWT", alg:"ES256"}
```

`YOUR_KEY_ID` ：參考上圖。
- JWT Payload：

```
{
  iss: 'YOUR_ISSUE_ID',
  iat: TOKEN 建立時間 (UNIX TIMESTAMP e.g 1658326020),
  exp: TOKEN 失效時間 (UNIX TIMESTAMP e.g 1658327220),
  aud: 'appstoreconnect-v1'
}
```

`YOUR_ISSUE_ID` ：參考上圖。

`exp TOKEN 失效時間` ：會因為不同存取功能或設定有不同的時間限制，有的可以永久、有的超過 20 分鐘即失效，需要重新產生，詳細可參考 [官方說明](https://developer.apple.com/documentation/appstoreconnectapi/generating_tokens_for_api_requests#3878467){:target="_blank"} 。
#### 使用 [JWT\.IO](https://jwt.io/){:target="_blank"} 或是以下附的 Ruby 範例產生 JWT
